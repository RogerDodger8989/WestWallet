17. Automatiska taggar / smart kategorisering (AI optional)
   - Funktion: POST /ai/categorize
   - Vid utgift: undersök leverantör, text, belopp, föreslå kategori

18. Webhooks (framtidssäkert)
   - /webhooks/subscribe, /webhooks/events
   - Händelser: post skapad, avtal slutar snart, ny bild uppladdad
   - Kan kopplas till Discord, Slack, Home Assistant, externa appar

19. Cache-lager (Redis eller Memory cache)
   - Cachea dashboard-data, statistik, kategorier, leverantörer, användarinställningar, bildmetadata

20. Multi-tenant / Multi-user-stöd
   - organizationId för hushåll, familjer, föreningar, företag
   - Flera användare per organisation

21. API Rate-Limiting per användare
   - 200 requests/min per användare
   - 20 writes/min
   - Stoppar abuse
WestWallet Backend Roadmap
==========================

1. Globalt ID-system (KLART)
   - Gemensam sekvens för alla poster (A000001, A000002 ...)
   - Robust ID-generator med MongoDB counter
   - Implementerat i `src/utils/id-generator.ts` och `src/models/counter.schema.ts`.
   - Funktion: `getNextGlobalId()` genererar nästa ID med prefix och sekvens.
   - **Schema-regler:**
     - ID måste matcha regex `/A\d{6}/`.
     - Fel returneras med `errorCode` vid sekvens- eller formatfel.

2. Användarhantering & autentisering
    - User-modell med:
       - preferences (notiser, UI, papperskorg, etc.)
       - trial (trial_start, trial_days_left, is_paid, payment_method, payment_history)
       - roller (admin/user/moderator)
   - JWT-login, refresh-token, e-postverifiering (KLART)
    - Read-only-läge efter trial-period (kan ej skapa/ändra/radera poster, ladda upp filer, exportera, synca kalender)
    - Banner vid slut på trial
    - Adminpanel: se användare, trial-status, betalhistorik
    - E-postverifiering vid registrering
    - Token-refresh för längre sessioner
    - Kryptering av känslig data (AES med crypto-js)
    - Lösenord hashas med bcrypt

3. Rollhantering & behörigheter
   - Endpoints skyddade med @Roles('admin') (KLART)
   - Rate limiting för mail/reset-password (KLART)

4. Undo-funktion & papperskorg
   - Mjukt radera (isDeleted, deletedAt) (KLART för användare)
   - Undo-knapp, restore-funktion
   - Papperskorg med lista på borttagna användare

5. Bild-/filhantering
   - /uploads/{ID}/... struktur (KLART)
   - API för uppladdning och radering (KLART)
   - Komprimering kan läggas till senare

6. Trial/prenumeration
   - Read-only-läge efter 30 dagar (KLART)
   - Banner, adminfält: trial_start, trial_days_left, is_paid, payment_method

7. Import/export
   - ZIP-format, remapping av ID vid import
   - Export av bilder/filer, rapporter

8. Notifieringar
   - Cron-jobb för dagliga påminnelser
   - Inställningar per användare
   - Massutskick via admin

9. Logging & audit trail (KLART)
   - Auditlog-schema och service
   - Alla ändringar i utgifter loggas automatiskt
   - Endpoint: GET /expenses/auditlog visar senaste loggar

10. Systemhälsa & adminpanel
    - Mailstatus, cronstatus, webhooks, uptime, disk, version

11. Modul-specifika endpoints
    - Ekonomihantering: transaktioner, kategorier, leverantörer
    - Avtal & abonnemang: betalningsfrekvens, status, statistik
    - Bilkostnader: bil, händelser, statistik
    - Garantier, försäkringar, hushållsunderhåll: full CRUD, notifieringar

12. Inställningar
    - users.preferences: notiser, UI, papperskorg, etc.
    - Adminpanel: systeminställningar

13. Export/rapportering
    - PDF/Excel/CSV, automatiska rapporter
    - Statistik, grafer, trendlinjer

14. Säkerhet & drift
    - HTTPS, .env, backup, cronjob

15. Bonus/AI
   - Kostnadsprognos, anomalidetektering, automatisk kategorisering

16. Köhantering (BullMQ/Nest Bull)
   - Tunga processer (import, PDF, mail, notiser, cronjobs, bildkomprimering) hanteras via BullMQ/Nest Bull
   - Separata workers, stabilt och skalbart

Prioritering:
1. ID-system, användarhantering, rollhantering
2. Undo/papperskorg, bildhantering, trial
3. Import/export, notifieringar, logging
4. Modul-endpoints, inställningar, rapportering
5. Säkerhet, drift, AI/bonus


API & Infrastruktur
✔ 8. WebSockets för live-uppdateringar
   - När en post skapas: andra flikar uppdateras automatiskt
   - Dashboards live-refresh
   - “ny bild uppladdad”-notification
   - NestJS Gateway gör det enkelt

Export-jobb som körs i bakgrunden
   - Ingen mer “vänta på export”-problematik
   - Backend kan köa export-jobb
   - Maila PDF/XLS när klart

Event Sourcing (avancerat men episk funktion)
   - Istället för att spara rådata alltid → spara events:
     - PostCreated, PostUpdated, FileUploaded, GuaranteeExpired, PaymentPosted
   - Bygg timeliner, audit, analyssystem

Device management
   - Backend håller koll på:
     - senaste inloggad enhet, IP-adresser, sessions, device-namn
   - Användaren kan logga ut andra sessioner

Datahantering
   - Soft delete + restore (papperskorg)
   - Alla poster först hamnar i “trashbin”
   - Admin och användare kan återställa

Skapa mellanberäkningar (cacheade stats)
   - Istället för att frontend ska processa allt:
   - Backend samlar: total expenses, total income, total by vendor, total by category, difference + prognos
   - Gör dashboards EXTREMT snabba

Billing, licenser & betalning
✔ 24. Full subscription-hantering
   - Backend hanterar: trial, grace-period, avstängning, återaktivering, webhooks från Stripe, invoice-historik

Admin-log viewer
   - Se loggar direkt i adminpanelen via API

Admin “impersonate user”
   - Admin kan se användarens vy, hjälpa dem med felet utan att få deras lösenord

Uppdatera roadmapen vid behov!

28. Offline sync-stöd (KLART)
   - Endpoint: GET /expenses/sync?since=timestamp
   - Returnerar endast ändrade poster sedan angiven tidpunkt
23. Avancerad felhantering (KLART)
   errorCode: "SUPPLIER_NOT_FOUND", "USER_NOT_FOUND", "CATEGORY_NOT_FOUND", "EXPENSE_NOT_FOUND", "ID_SEQUENCE_FAILED", "ID_FORMAT_INVALID"
   Alla services och controllers returnerar errorCode vid fel

27. Avancerade mail-teman (MJML) (KLART)
   - Backend kan generera fakturamail, påminnelsemail, välkomstmail, rapportmail
   - Mallar i src/email/mail-templates.ts
   - MJMLService och MJMLModule för rendering
   Kan användas i frontend för proffsig UX

24. Statistik & rapporter via Aggregation (KLART)
   GET /expenses/stats/:year summerar utgifter per kategori och månad
   Minska antalet queries med aggregation pipelines